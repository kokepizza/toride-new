import { useState, useRef, useEffect } from "react";
import { gsap } from "gsap";
import "./header.css";

export default function Header() {
  const [isOpen, setIsOpen] = useState(false);
  const navRef = useRef(null);
  const topRef = useRef(null);
  const middleRef = useRef(null);
  const bottomRef = useRef(null);
  const linkRefs = useRef([]);

  const addLinkRef = (el, i) => {
    if (el && !linkRefs.current[i]) {
      linkRefs.current[i] = el;
    }
  };

  useEffect(() => {
    if (window.innerWidth >= 1024) return; // solo móviles

    // Estado inicial
    gsap.set(navRef.current, { y: "-100%", visibility: "visible" });
    gsap.set(linkRefs.current, { y: -50, opacity: 0 });
  }, []);

  useEffect(() => {
    if (window.innerWidth >= 1024) return;

    document.body.style.overflow = isOpen ? "hidden" : "auto";

    const tl = gsap.timeline();

    if (isOpen) {
      // Abrir menú:
      tl.to(navRef.current, { y: "0%", duration: 0.7, ease: "power2.out" })
        .to(linkRefs.current,{ y: 0, opacity: 1, duration: 0.6, stagger: 0.15, ease: "back.out(1.7)" },"-=0.3")

        // Burger to X
        .to(topRef.current, { y: 10, duration: 0.25 }, 0)
        .to(bottomRef.current, { y: -10, duration: 0.25 }, 0)
        .to(middleRef.current, { opacity: 0, duration: 0.25 }, 0.1)
        .to(topRef.current, { rotate: 45, transformOrigin: "center", duration: 0.35 }, 0.2)
        .to(bottomRef.current, { rotate: -45, transformOrigin: "center", duration: 0.35 }, 0.2);
    } else {
      // Cerrar menú
      tl.to(linkRefs.current, { y: -50, opacity: 0, duration: 0.4, stagger: 0.1, ease: "power3.in" },0 )
        .to(navRef.current, { y: "-100%", duration: 0.5, ease: "power2.in" }, "-=0.2")

        // X to Burger
        .to(topRef.current, { rotate: 0, duration: 0.35 }, 0)
        .to(bottomRef.current, { rotate: 0, duration: 0.35 }, 0)
        .to(middleRef.current, { opacity: 1, duration: 0.25 }, 0.2)
        .to(topRef.current, { y: 0, duration: 0.25 }, 0.3)
        .to(bottomRef.current, { y: 0, duration: 0.25 }, 0.3);
    }

    return () => {
      document.body.style.overflow = "auto";
    };
  }, [isOpen]);

  return (
    <header className="header">
      <div className="header-container">
        <a href="/" className="header-logo">
            <svg viewBox="0 0 1114.4 800" height="56" fill="var(--black)">
              <g className="oride" fill="var(--black)">
                <path className="oride-o" d="M469.4,340.3c-5.8-14.1-13.5-21.5-15.1-23-7.7-7.1-15.5-10.4-19.1-11.9,0,0-9.8-4.2-21.3-4.8-20.7-1.1-51.6,8.3-77.7,29.6-32.6,26.6-43.1,60-46.5,71.4-3.5,11.6-9,30.8-4.5,54.7,2,10.4,4.3,22.3,13.4,33,22.9,26.8,65.5,19.2,69.9,18.4,12.6-2.4,22.6-7.5,28.2-10.4,3.2-1.6,15.9-8.3,29.4-20.7,8.5-7.8,42.7-39.2,48.5-88.7,3.1-26.3-3.5-43.4-5.2-47.5h0ZM437.8,361.5c-1,4.5-2.6,10.4-5.9,21.9-1,3.5-2.9,10.4-3.8,13.3-6.4,21.5-18.1,44-22,51.4-9.2,17.2-13.8,25.8-22.6,35.3-8.9,9.5-17,18.1-29.6,18.9-1,0-15.6.8-25.1-9.6-6-6.6-7-14.4-8-23-1.1-8.8-.3-16.2,1.1-24.8,3.5-20.1,9.4-35.7,12.2-42.8,4.9-12.3,12.8-28.7,24.9-45.9,7.9-11.1,14.3-18,15.8-19.6,8.4-8.9,16.5-15.4,22.9-19.9,11.3-9.3,24.9-11.5,32.8-6,6.6,4.6,8.8,14.1,9.5,17,1,4.5.9,7.9.7,13.6-.3,8.2-1.6,14.2-2.9,20.3h0Z"/>
                <path className="oride-r" d="M466.6,479.1c-6,18.3-10,30.4-10,30.4h50.2c5.3-16.7,13.3-40.8,24.1-69.5,15.9-42.6,24.1-64.1,35.8-78.4,10.6-13,36.4-38.5,93.5-47.5-25.1-3-44.1-.1-56.9,3-18.6,4.6-45.8,15.2-44.9,14.9l6.9-24.1h-42.6s-37.6,114.8-56.1,171.1h0Z" />
                <path className="oride-i" d="M540.5,509.1c8.6-1.3,36.4-7.3,50.2-14.4,24.4-12.7,37.4-31.2,46.8-45,16.8-24.6,23.2-46.7,31-74.3,4.7-16.6,10-39.6,13-67.8h50.2c-2.2,17.3-4.8,31.4-6.8,41.3-6.4,32.1-11.7,57.7-26.9,86.3-4.4,8.2-8.6,16-16,25.2-19.1,23.5-41.3,33.9-47.8,36.8-18.2,8-33.5,9.4-54,11.4-16.2,1.5-29.8,1.2-39.5.7" />
                <circle className="oride-ipunto" cx="706.4" cy="252.3" r="25.2" />
                <path className="oride-d" d="M862.8,311s-11.3-2.2-26.2,0c-28.6,4.3-47.7,21.4-50.7,24.2-24.4,22.6-39.4,61.1-28.2,89.7,4.2,10.7,10.4,16.9,12.4,18.8,11.8,10.9,29.9,15.8,45.6,11,9.2-2.8,15.5-8.3,19.9-12.9,27.5-29,31.3-80.8,32.2-100.4,1-24.9-.5-65-17.2-112.6h50.2c10.8,37.9,13.5,70.1,14,92.4.5,25,1,71.2-21.3,119.7-9.1,19.8-17.2,29.6-23.4,35.8-9.1,9.1-29.2,29.6-60.8,30.2-37.6.7-60.9-27.2-63-29.9-13.8-17.1-16.2-35.2-17.4-45.3-5.6-46.2,22.3-79.9,27.2-85.7,5.1-6.1,19.8-22.9,44.2-31.6,31.4-11.3,62.7-3.5,62.7-3.4h-.2Z" />
                <path className="oride-e" d="M1061.1,507.8c21.3.7,37.2-1.4,39.9-1.8l13.4-48.4c-29.8,3.6-60.8,1.9-78.3-.1-37.8-4.3-48.7-12.9-54-18.2-10.9-10.9-14.1-23.9-15.8-30.6-1.5-6.1-6.8-30.3,6.2-53.3,6.7-11.8,15.2-18.2,17.2-19.6,4.1-3,10.2-7.3,19.3-8.9,13.3-2.4,23.8,2.4,26.5,3.8,3.1,1.6,14,7.2,19.6,20.3,6.9,16.2,0,31-1,33.4-5.8,12.1-16.1,17.5-26.1,22.7-13.4,7-31.8,11.6-41,12.1,43.9,2.3,77.2-21.6,81.6-49.1,3.8-24-15.5-43.1-17-44.5-25-23.9-70-20.2-97.2,1.4-36.6,29-28.5,80.7-26.6,90.8.6,3.3,4.6,23.5,18.3,42.2,27.8,37.9,79,46.7,115.1,47.8h0Z" />
              </g>
              <g className="imagotipo" fill="var(--black)">
                <path className="imagotipo-arm" d="M0,294.3c144.4-16.5,276.5-127.9,276.5-127.9l35.4,51.6S168.5,332.4,0,294.3" />
                <path className="imagotipo-leg" d="M224.4,695.1c-16.6-75.4-12.4-136.9-7.1-174.5,7.9-55.4,20.9-145.9,93.5-207.7,4.9-4.2,25-20.9,59.1-36.4,122.9-55.9,256.6-18.5,307.5-1.8C-6.6,20.3,224.4,695.1,224.4,695.1" />
                <circle className="imagotipo-head" cx="227.2" cy="144" r="35.9" />
              </g>
            </svg>
        </a>

        <button className="burger" onClick={() => setIsOpen(!isOpen)}>
          <svg width="40" height="40" viewBox="0 0 50 50" stroke="var(--black)">
            <line ref={topRef} x1="10" y1="15" x2="40" y2="15" strokeWidth="4" strokeLinecap="round"/>
            <line ref={middleRef} x1="10" y1="25" x2="40" y2="25" strokeWidth="4" strokeLinecap="round"/>
            <line ref={bottomRef} x1="10" y1="35" x2="40" y2="35" strokeWidth="4" strokeLinecap="round"/>
          </svg>
        </button>
      </div>

      <nav ref={navRef} className="nav">
        <a href="/la-escuela" ref={(el) => addLinkRef(el, 0)}>La escuela</a>
        <a href="/programas" ref={(el) => addLinkRef(el, 1)}>Programas</a>
        <a href="/tienda" ref={(el) => addLinkRef(el, 2)}>Tienda</a>
        <a href="/contacto" ref={(el) => addLinkRef(el, 3)}>Contacto</a>
      </nav>

      <div ref={(el) => addLinkRef(el, 4)} className="rrss">
        <a href="https://www.instagram.com/toridemartialarts/" target="_blank" rel="noopener noreferrer">
            <svg width="32" height="32" viewBox="0 0 24 24">
                <path d="M13.028 2C14.153 2.003 14.724 2.009 15.217 2.023L15.411 2.03C15.635 2.038 15.856 2.048 16.123 2.06C17.187 2.11 17.913 2.278 18.55 2.525C19.21 2.779 19.766 3.123 20.322 3.678C20.8307 4.17773 21.2242 4.78247 21.475 5.45C21.722 6.087 21.89 6.813 21.94 7.878C21.952 8.144 21.962 8.365 21.97 8.59L21.976 8.784C21.991 9.276 21.997 9.847 21.999 10.972L22 11.718V13.028C22.0025 13.7574 21.9948 14.4868 21.977 15.216L21.971 15.41C21.963 15.635 21.953 15.856 21.941 16.122C21.891 17.187 21.721 17.912 21.475 18.55C21.2242 19.2175 20.8307 19.8223 20.322 20.322C19.8223 20.8307 19.2175 21.2242 18.55 21.475C17.913 21.722 17.187 21.89 16.123 21.94L15.411 21.97L15.217 21.976C14.724 21.99 14.153 21.997 13.028 21.999L12.282 22H10.973C10.2433 22.0026 9.51354 21.9949 8.78402 21.977L8.59002 21.971C8.35263 21.962 8.11529 21.9517 7.87802 21.94C6.81402 21.89 6.08802 21.722 5.45002 21.475C4.78285 21.2241 4.17846 20.8306 3.67902 20.322C3.16996 19.8224 2.77613 19.2176 2.52502 18.55C2.27802 17.913 2.11002 17.187 2.06002 16.122L2.03002 15.41L2.02502 15.216C2.00659 14.4868 1.99825 13.7574 2.00002 13.028V10.972C1.99725 10.2426 2.00459 9.5132 2.02202 8.784L2.02902 8.59C2.03702 8.365 2.04702 8.144 2.05902 7.878C2.10902 6.813 2.27702 6.088 2.52402 5.45C2.77571 4.7822 3.17024 4.17744 3.68002 3.678C4.17917 3.16955 4.78321 2.77607 5.45002 2.525C6.08802 2.278 6.81302 2.11 7.87802 2.06C8.14402 2.048 8.36602 2.038 8.59002 2.03L8.78402 2.024C9.51321 2.00623 10.2426 1.99857 10.972 2.001L13.028 2ZM12 7C10.6739 7 9.40217 7.52678 8.46449 8.46447C7.5268 9.40215 7.00002 10.6739 7.00002 12C7.00002 13.3261 7.5268 14.5979 8.46449 15.5355C9.40217 16.4732 10.6739 17 12 17C13.3261 17 14.5979 16.4732 15.5356 15.5355C16.4732 14.5979 17 13.3261 17 12C17 10.6739 16.4732 9.40215 15.5356 8.46447C14.5979 7.52678 13.3261 7 12 7ZM12 9C12.394 8.99993 12.7841 9.07747 13.1481 9.22817C13.5121 9.37887 13.8429 9.5998 14.1215 9.87833C14.4001 10.1569 14.6211 10.4875 14.772 10.8515C14.9228 11.2154 15.0005 11.6055 15.0005 11.9995C15.0006 12.3935 14.9231 12.7836 14.7723 13.1476C14.6216 13.5116 14.4007 13.8423 14.1222 14.121C13.8437 14.3996 13.513 14.6206 13.149 14.7714C12.7851 14.9223 12.395 14.9999 12.001 15C11.2054 15 10.4423 14.6839 9.8797 14.1213C9.31709 13.5587 9.00102 12.7956 9.00102 12C9.00102 11.2044 9.31709 10.4413 9.8797 9.87868C10.4423 9.31607 11.2054 9 12.001 9M17.251 5.5C16.9195 5.5 16.6016 5.6317 16.3671 5.86612C16.1327 6.10054 16.001 6.41848 16.001 6.75C16.001 7.08152 16.1327 7.39946 16.3671 7.63388C16.6016 7.8683 16.9195 8 17.251 8C17.5825 8 17.9005 7.8683 18.1349 7.63388C18.3693 7.39946 18.501 7.08152 18.501 6.75C18.501 6.41848 18.3693 6.10054 18.1349 5.86612C17.9005 5.6317 17.5825 5.5 17.251 5.5Z" />
            </svg>  
        </a>
      </div>
    </header>
  );
}